\parrafo{Introducci√≥n}

Mocha is a feature-rich JavaScript test framework running on node.js
and the browser, making asynchronous testing simple and fun. Mocha tests
run serially, allowing for flexible and accurate
reporting, while mapping uncaught exceptions to the correct test cases.

\begin{itemize}
\item
\htmladdnormallink{http://mochajs.org/}{http://mochajs.org/}
\item
\htmladdnormallink{https://github.com/visionmedia/mocha}{https://github.com/visionmedia/mocha}
\item
\begin{itemize}
\item
An example setup for unit testing JavaScript in the browser with the Mocha testing framework and Chai assertions:
\htmladdnormallink{https://github.com/ludovicofischer/mocha-chai-browser-demo}{https://github.com/ludovicofischer/mocha-chai-browser-demo}
\item
\htmladdnormallink{Karma - a test runner}{http://karma-runner.github.io/0.10/index.html}
\end{itemize}
\end{itemize}

\parrafo{mocha init}

\begin{verbatim}
[~/srcPLgrado/mocha-chai-browser-demo(master)]$ mocha --help

  Usage: _mocha [debug] [options] [files]

  Commands:

    init <path>            initialize a client-side mocha setup at <path>

  Options:

    -h, --help                      output usage information
    -V, --version                   output the version number
    -r, --require <name>            require the given module
    -R, --reporter <name>           specify the reporter to use
    -u, --ui <name>                 specify user-interface (bdd|tdd|exports)
    -g, --grep <pattern>            only run tests matching <pattern>
    -i, --invert                    inverts --grep matches
    -t, --timeout <ms>              set test-case timeout in milliseconds [2000]
    -s, --slow <ms>                 "slow" test threshold in milliseconds [75]
    -w, --watch                     watch files for changes
    -c, --colors                    force enabling of colors
    -C, --no-colors                 force disabling of colors
    -G, --growl                     enable growl notification support
    -d, --debug                     enable node's debugger, synonym for node --debug
    -b, --bail                      bail after first test failure
    -A, --async-only                force all tests to take a callback (async)
    -S, --sort                      sort test files
    --recursive                     include sub directories
    --debug-brk                     enable node's debugger breaking on the first line
    --globals <names>               allow the given comma-delimited global [names]
    --check-leaks                   check for global variable leaks
    --interfaces                    display available interfaces
    --reporters                     display available reporters
    --compilers <ext>:<module>,...  use the given module(s) to compile files
    --inline-diffs                  display actual/expected differences inline within each string
    --no-exit                       require a clean shutdown of the event loop: mocha will not call process.exit
\end{verbatim}

\begin{verbatim}
[~/srcPLgrado]$ mocha init chuchu
[~/srcPLgrado]$ ls -ltr
total 16
....
drwxr-xr-x   6 casiano  staff  204 20 ene 11:16 chuchu
[~/srcPLgrado]$ tree chuchu/
chuchu/
|-- index.html
|-- mocha.css
|-- mocha.js
`-- tests.js
\end{verbatim}

\begin{verbatim}
[~/srcPLgrado/mocha-tutorial]$ cat test/test.js 
var assert = require("assert")
describe('Array', function(){
  describe('#indexOf()', function(){
    it('should return -1 when the value is not present', function(){
      assert.equal(-1, [1,2,3].indexOf(5));
      assert.equal(-1, [1,2,3].indexOf(0));
      assert.equal( 0, [1,2,3].indexOf(99));
    })
  })
})
\end{verbatim}

\begin{verbatim}
[~/srcPLgrado/mocha-tutorial]$ mocha
  .
  0 passing (5ms)
  1 failing

  1) Array #indexOf() should return -1 when the value is not present:
     AssertionError: 0 == -1
      at Context.<anonymous> (/Users/casiano/local/src/javascript/PLgrado/mocha-tutorial/test/test.js:7:14)
\end{verbatim}

Mocha allows you to use any assertion library you want, if it throws
an error, it will work! This means you can utilize libraries such as
should.js, node's regular assert module, or others. 


\parrafo{Browser support}

Mocha runs in the browser. 

\begin{itemize}
\item
Every release of Mocha will have new builds
of \verb|./mocha.js| and \verb|./mocha.css| for use in the browser. 

\item
To setup Mocha
for browser use all you have to do is include the script, stylesheet,
\item
Tell Mocha which interface you wish to use, and then 
\item
Run the tests. 
\end{itemize}
A
typical setup might look something like the following, where we call
\verb|mocha.setup('bdd')| to use the BDD interface before loading the test
scripts, running them onload with \verb|mocha.run()|.

\begin{verbatim}
<html>
<head>
  <meta charset="utf-8">
  <title>Mocha Tests</title>
  <link rel="stylesheet" href="mocha.css" />
</head>
<body>
  <div id="mocha"></div>
  <script src="jquery.js"></script>
  <script src="expect.js"></script>
  <script src="mocha.js"></script>

  <script>mocha.setup('bdd')</script>

  <script src="test.array.js"></script>
  <script src="test.object.js"></script>
  <script src="test.xhr.js"></script>

  <script>
    mocha.checkLeaks();
    mocha.globals(['jQuery']);
    mocha.run();
  </script>

</body>
</html>
\end{verbatim}

\begin{itemize}
\item
Mocha "interface" system allows developers to choose their style of
DSL. Shipping with BDD, TDD, and exports flavoured interfaces.
\item
\verb|mocha.globals([names ...])|

A list of accepted global variable names. For example, suppose your app deliberately exposes a global named app and YUI

\item
\verb|mocha.checkLeaks()|

By default Mocha will not check for global variables leaked while running tests
\end{itemize}


\parrafo{TDD}

The \cei{Mocha TDD interface} provides \verb|suite()|, \verb|test()|, \verb|setup()|, and \verb|teardown()|.

\begin{verbatim}
suite('Array', function(){
  setup(function(){
    // ...
  });

  suite('#indexOf()', function(){
    test('should return -1 when not present', function(){
      assert.equal(-1, [1,2,3].indexOf(4));
    });
  });
});
\end{verbatim}


