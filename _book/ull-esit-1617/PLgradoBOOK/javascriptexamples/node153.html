
<H1><A NAME="SECTION056160000000000000000">
Optimización de Código</A>
</H1>
Aunque en esta fase se incluyen toda clase de optimizaciones,
es aquí donde se hacen las optimizaciones de código dependientes
del sistema objeto. Normalmente se
recorre el código generado buscando secuencias 
de instrucciones que se puedan sustituir por otras cuya 
ejecución sea mas eficiente.
El nombre <A NAME="12256"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">Peephole optimization</SPAN> hace alusión a esta especie de
``ventana
de visión'' que se desplaza sobre el código.  En nuestro caso,
supongamos que disponemos de una instrucción <tex2html_verb_mark>2079<tex2html_verb_mark> que permite
incrementar eficientemente una expresión. Recorremos el código buscando
por un patrón ;SPMquot;sumar 1;SPMquot; y lo reeemplazamos adecuadamente.

<P>
<PRE><tex2html_verbatim_mark>verbatim5665#</PRE>

<P>
Otro ejemplo de optimización peephole consiste en reemplazar las operaciones
flotantes de división por una constante por la multiplicación por la inversa
de la misma (aquí se pueden introducir diferencias en el resultado, debido
a la inexactitud de las operaciones en punto flotante y a que, si
se trata de un <A NAME="12258"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">compilador cruzado</SPAN> la aritmética 
flotante en la máquina en la que se ejecuta el compilador puede ser diferente
de la de la máquina que ejecutará el código objeto).

<P>

<H2><A NAME="SECTION056161000000000000000"><tex2html_anchor_invisible_mark></A>
   <A NAME="12261"><tex2html_anchor_invisible_mark></A>
  
<A NAME="practica:peephole"><tex2html_anchor_mark></A><BR>
Práctica: Optimización Peephole
</H2>

<OL>
<LI>Optimice el código generado para la máquina de registros sustituyendo
las operaciones de multiplicación y división enteras por una constante que sea
potencia de dos (de la forma <SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline35930#</SPAN>
<tex2html_verbatim_mark>mathend000#) por operaciones de desplazamiento.
Repase el capítulo de expresiones regulares. Es posible que aquí quiera emplear
una sustitución en la que la cadena de reemplazo
sea evaluada sobre la marcha. Si es así, repase la sección
<A HREF=<tex2html_cr_mark>#section:regeval#11740><tex2html_cr_mark></A>. La siguiente sesión con el depurador
pretende ilustrar la idea:
<PRE><tex2html_verbatim_mark>verbatim5666#</PRE>

<P>
</LI>
<LI>El plegado de constantes realizado durante la optimización de código independiente
de la máquina (véase la sección
<A HREF=<tex2html_cr_mark>#section:optimizacion#11743><tex2html_cr_mark></A>)
es parcial. Si los árboles para el producto se hunden a izquierdas, una expresión
como <tex2html_verb_mark>2080<tex2html_verb_mark> no será plegada, ya que produce
un árbol de la forma 

<P>
<DIV ALIGN="CENTER">
<tex2html_verbatim_mark>#math6846#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline35932#</SPAN>
<tex2html_verbatim_mark>mathend000#
</DIV>

<P>
Dado que el algoritmo no
puede plegar <SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline35934#</SPAN>
<tex2html_verbatim_mark>mathend000# tampoco plegará <SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline35936#</SPAN>
<tex2html_verbatim_mark>mathend000#.  Busque en el código objeto
secuencias de multiplicaciones 
por constantes y abrévielas en una. Haga lo mismo para las restantes operaciones.

<P>
</LI>
<LI>Dado el siguiente programa:
<PRE><tex2html_verbatim_mark>verbatim5667#</PRE>
El código producido por el traductor para la máquina de registros es:
<PRE><tex2html_verbatim_mark>verbatim5668#</PRE>
Se ve que la instrucción de carga <tex2html_verb_mark>2081<tex2html_verb_mark> de la 
línea 3 es innecesaria por cuanto
el contenido de la variable <tex2html_verb_mark>2082<tex2html_verb_mark> ya está en el registro <tex2html_verb_mark>2083<tex2html_verb_mark>, 
ya que fué cargada en el registro en la línea 2.
Nótese que esta hipótesis no es necesariamente cierta
si la línea 3 fuera el objetivo de un salto desde 
otro punto del programa. Esta condición se cumple
cuando nos movemos dentro de un <A NAME="12262"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">bloque básico</SPAN>: 
una secuencia de instrucciones que no contiene instrucciones
de salto ni es el objetivo de instrucciones de salto, con la excepción
de las instrucciones inicial y final.
Mejore el código generado 
intentando detectar patrones
de este tipo, eliminando la operación de carga correspondiente.
</LI>
</OL>
<tex2html_endfile>#./chapter_descendente/descendente_en_perl.tex#

<P>
