
<H1><A NAME="SECTION056110000000000000000"><tex2html_anchor_invisible_mark></A>
<A NAME="section:optimizacion"><tex2html_anchor_mark></A><BR>
Optimización Independiente de la Máquina
</H1>
En esta fase se hace un análisis del árbol, sometiéndolo a transformaciones 
que aumenten la eficiencia del código final producido. 

<P>
Ejemplos de tareas que se pueden llevar a cabo en esta fase son: 

<UL>
<LI>Extracción del interior de un bucle de cálculos que son invariantes del bucle
</LI>
<LI>Plegado de constantes: computar las expresiones constantes en tiempo de compilación,
no de ejecución
</LI>
<LI>Propagación de las constantes: si se sabe que una variable  en un punto del programa
tiene un valor constante <tex2html_verb_mark>1923<tex2html_verb_mark>, se puede sustituir su uso por el de la constante
</LI>
<LI>Eliminación de computaciones redundantes, cuando la misma expresión aparece repetidas
veces con los mismos valores de las variables
</LI>
<LI>La eliminación de código ``muerto'': código que se sabe que nunca podrá ser ejecutado
</LI>
</UL>

<P>
En nuestro primer ejemplo, reduciremos esta fase a realizar una tarea de plegado
de las constantes. Primero lo haremos mediante la rutina

<P>
<DIV ALIGN="CENTER">
</DIV><PRE><tex2html_verbatim_mark>verbatim5605#</PRE><DIV ALIGN="CENTER">
</DIV>

<P>
En esta fase transformamos los AAA: si tenemos un árbol de la forma 
OPERATION(left, right), esto es, su raíz es una operación,
primero plegamos los subárboles left y right, y si se han
transformado en constantes numéricas, entonces plegamos el nodo
que pasa a ser numérico:

<P>
<PRE><tex2html_verbatim_mark>verbatim5606#</PRE>

<P>
El plegado de las operaciones binarias se ha delegado
en la subrutina <tex2html_verb_mark>1924<tex2html_verb_mark>. En las líneas 3 y 6 se comprueba
que se trata de un nodo de tipo operación. Si es así se procede
a su plegado. Una vez plegados los dos subárboles hijo comprobamos
en la línea 9 que los hijos actuales son de la clase <tex2html_verb_mark>1925<tex2html_verb_mark>.
Si es el caso, en la línea 10 cambiamos el nodo por el resultado de operar
los dos hijos. Los nodos han sido
extendidos con un método <tex2html_verb_mark>1926<tex2html_verb_mark> que determina si 
se trata de un nodo operación binaria o no. Para ello 
se han introducido nuevas clases de nodos: la clase <tex2html_verb_mark>1927<tex2html_verb_mark>
está en la raíz de la jerarquía de herencia, las clases <tex2html_verb_mark>1928<tex2html_verb_mark>
y <tex2html_verb_mark>1929<tex2html_verb_mark> se usan para representar los nodos hoja y binarios
y heredan de la anterior.
Una clase informa a Perl que desea heredar de otra clase añadiendo 
el nombre de esa clase a la variable <tex2html_verb_mark>1930<tex2html_verb_mark> de su paquete.
La herencia en Perl determina la forma de búsqueda de un método. Si el objeto
no se puede encontrar en la clase, recursivamente y en orden primero-profundo
se busca en las clases de las cuales esta hereda, esto es en las clases
especificadas en el vector <tex2html_verb_mark>1931<tex2html_verb_mark>.

<P>
<PRE><tex2html_verbatim_mark>verbatim5607#</PRE>
Así pues, los objetos de la clase <tex2html_verb_mark>1932<tex2html_verb_mark> tienen acceso 
al método <tex2html_verb_mark>1933<tex2html_verb_mark>.

<P>
Ahora hacemos que las clases <tex2html_verb_mark>1934<tex2html_verb_mark> y <tex2html_verb_mark>1935<tex2html_verb_mark> 
hereden de la clase <tex2html_verb_mark>1936<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim5608#</PRE>

<P>
Obsérvese que en las líneas 4 y 7 del código del plegado
de nodos de operación se ha accedido directamente 
al dato en vez de usar el método para modificar el atributo, 
saltándonos lo que la buena programación
orientada a objetos indica. La forma en la que esta escrito
hace que, por ejemplo, <tex2html_verb_mark>1937<tex2html_verb_mark> sea modificado. 
Recuérdese que en Perl
<SPAN  CLASS="textbf">los argumentos son alias de los parámetros</SPAN>.

<P>
La subrutina <tex2html_verb_mark>1938<tex2html_verb_mark> es la encargada 
de crear el nuevo nodo con el resultado de operar los
hijos izquierdo y derecho:

<P>
<PRE><tex2html_verbatim_mark>verbatim5609#</PRE>

<P>
En la línea 4 se usa el método <tex2html_verb_mark>1939<tex2html_verb_mark> asociado 
con un nodo operación. 

<P>
Plegar una sentencia de impresión es plegar la expresión
a imprimir:
<PRE><tex2html_verbatim_mark>verbatim5610#</PRE>
Plegar una sentencia de asignación es plegar
la parte derecha de la asignación:
<PRE><tex2html_verbatim_mark>verbatim5611#</PRE>
de nuevo, hemos accedido a los campos en vez de usar los métodos.

<P>
Las restantes operaciones de plegado son triviales:
<PRE><tex2html_verbatim_mark>verbatim5612#</PRE>
Por último, para plegar todas las expresiones
recorremos la lista de sentencias del programa
y las plegamos una a una.

<P>
<PRE><tex2html_verbatim_mark>verbatim5613#</PRE>

<P>

<H2><A NAME="SECTION056111000000000000000"><tex2html_anchor_invisible_mark></A>
   <A NAME="12213"><tex2html_anchor_invisible_mark></A><BR>
Práctica: Plegado de las Constantes
</H2>
  
Complete su proyecto de compilador de Tutu 
con la fase de plegado de las constantes siguiendo 
la metodología explicada 
en los párrafos previos. Mejore la jerarquía de 
clases con una clase abstracta <tex2html_verb_mark>1940<tex2html_verb_mark> que represente a los nodos
que se corresponden con operaciones binarias. Defina el método
abstracto <tex2html_verb_mark>1941<tex2html_verb_mark> en dicha clase. 
Un <A NAME="12214"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">método abstracto</SPAN> es uno que, mas que proveer un servicio 
representa un servicio o categoría.
La idea es que al definir un clase base abstracta se indica un conjunto de métodos
que deberían estar definidos en todas las clases que heredan de la clase base abstracta.
Es como una declaración de interfaz que indica la necesidad de definir su funcionalidad
en las clases descendientes, pero que no se define en la clase base.
Un método abstracto debe producir una excepción con el mensaje de error adecuado
si no se ha redefinido en la clase desendiente. 

<P>
Para ello use la clave 
<tex2html_verb_mark>1942<tex2html_verb_mark> del módulo <tex2html_verb_mark>1943<tex2html_verb_mark>. Consulte 
la documentación del módulo <tex2html_verb_mark>1944<tex2html_verb_mark>. Consulte 
<A HREF=<tex2html_ext_cr_mark>#subsection:abstractos#12216><tex2html_ext_cr_mark></A> [#CasianoIntroAPerl#<tex2html_cite_mark>#1##<tex2html_cite_mark>#]
para saber más sobre clases abstractas.

<P>
