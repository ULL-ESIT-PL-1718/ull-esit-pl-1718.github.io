
<H1><A NAME="SECTION05810000000000000000"><tex2html_anchor_invisible_mark></A>
<A NAME="section:ejemplodeuso"><tex2html_anchor_mark></A><BR>
<TT>Parse::Yapp</TT>: Ejemplo de Uso
</H1>
El generador de analizadores sintácticos  <#18308#><TT>Parse::Yapp</TT><#18308#>  es un
analizador LALR inspirado en  <#18309#><TT>yacc</TT><#18309#> . El módulo
<tex2html_verb_mark>2220<tex2html_verb_mark> no viene con la distribución de Perl, por lo que es necesario
bajarlo desde CPAN, en la dirección 

<P>
<tex2html_verbatim_mark>rawhtml6093#

<P>
o bien en nuestros servidores locales,
por ejemplo en el mismo directorio en que se guarda
la versión HTML de estos apuntes encontrará una copia de 
<A NAME="tex2html401"
  HREF="Parse-Yapp-1.05.tar.gz">Parse-Yapp-1.05.tar.gz</A>.
La versión a la que se refiere este capítulo es la 1.05.

<P>
Para ilustrar su uso veamos
un ejemplo en el que se genera una sencilla calculadora numérica. 
Los contenidos del programa  <#18310#><TT>yapp</TT><#18310#>  los hemos guardado
en un fichero denominado <tex2html_verb_mark>2221<tex2html_verb_mark>
(el código completo figura en el apéndice 
en la página <A HREF=<tex2html_cr_mark>#apendice:calcyp#17257><tex2html_cross_ref_visible_mark></A>)

<P>
<PRE><tex2html_verbatim_mark>verbatim6094#</PRE>
Se pueden poner comentarios tipo Perl o tipo C (<tex2html_verb_mark>2222<tex2html_verb_mark>)
a lo largo del fichero.
<PRE><tex2html_verbatim_mark>verbatim6095#</PRE>
las declaraciones  <#18311#><TT><tex2html_percent_mark>left</TT><#18311#>  y  <#18312#><TT><tex2html_percent_mark>right</TT><#18312#>  expresan la asociatividad
y precedencia de los terminales, permitiendo decidir que árbol construir 
en caso de  ambiguedad. 
<SPAN  CLASS="textbf"> Los terminales declarados en líneas 
posteriores tienen mas prioridad que los declarados en las líneas anteriores</SPAN>.
Véase la sección <A HREF=<tex2html_cr_mark>#section:prioridades#17265><tex2html_cr_mark></A> para mas detalles.

<P>
Un programa <tex2html_verb_mark>2223<tex2html_verb_mark> consta de tres partes: la cabeza, el cuerpo
y la cola. Cada una de las partes va separada de las otras por el
símbolo <tex2html_verb_mark>2225<tex2html_verb_mark> en una línea aparte. Así, el <tex2html_verb_mark>2226<tex2html_verb_mark> de la línea 15
separa la cabeza del cuerpo. En la cabecera se colocan el
código de inicialización, las declaraciones de terminales, las reglas
de precedencia, etc.  El cuerpo contiene las reglas de la gramática y
las acciones asociadas. Por último, la cola de un program <tex2html_verb_mark>2227<tex2html_verb_mark>
contiene las rutinas de soporte al código que aparece en las acciones 
asi como, posiblemente, rutinas para el análisis léxico 
y el tratamiento de errores.

<P>
En <tex2html_verb_mark>2228<tex2html_verb_mark> las acciones son convertidas en subrutinas
anónimas. Mas bien en métodos anónimos. 
Así pues el primer argumento de la subrutina se identifica con 
una referencia al analizador (<tex2html_verb_mark>2229<tex2html_verb_mark>).  Los restantes parámetros
se corresponden con los <A NAME="18313"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">atributos de los símbolos</SPAN>
en la parte derecha de la regla de producción (<tex2html_verb_mark>2230<tex2html_verb_mark> ...).
Por ejemplo, el código en la línea 21 imprime el atributo asociado
con la variable sintáctica <tex2html_verb_mark>2231<tex2html_verb_mark>, que en este caso es su valor numérico.

<P>
La línea 17 indica que el atributo asociado con la variable
sintáctica <tex2html_verb_mark>2232<tex2html_verb_mark> es una referencia
a una pila y que el atributo asociado con la variable sintáctica
<tex2html_verb_mark>2233<tex2html_verb_mark> debe empujarse
en la pila. De hecho, el atributo asociado con <tex2html_verb_mark>2234<tex2html_verb_mark> es el valor
de la expresión. Asi pues el atributo retornado por <tex2html_verb_mark>2235<tex2html_verb_mark> es
una referencia a una lista conteniendo los valores de las expresiones
evaluadas.

<P>
Para saber mas sobre las estructuras internas de 
<tex2html_verb_mark>2236<tex2html_verb_mark> para la representación  de las acciones asociadas con las reglas
véase la sección <A HREF=<tex2html_cr_mark>#section:tablas#17267><tex2html_cr_mark></A>.

<P>
<PRE><tex2html_verbatim_mark>verbatim6096#</PRE>

<P>
El terminal
<tex2html_verb_mark>2237<tex2html_verb_mark> en la línea 22 esta asociado con la aparición de un error.
El tratamiento es el mismo que en <tex2html_verb_mark>2238<tex2html_verb_mark>. Cuando se produce un error
en el análisis, <tex2html_verb_mark>2239<tex2html_verb_mark> emite un mensaje de error y
produce ``mágicamente'' un terminal especial denominado
<tex2html_verb_mark>2240<tex2html_verb_mark>. A partir de ahí permanecerá silencioso,
consumiendo terminales hasta encontrar uno de los terminales que le
hemos indicado en las reglas de recuperación de errores,
en este caso, cuando encuentre un retorno de carro.
Como se ha dicho, en <tex2html_verb_mark>2241<tex2html_verb_mark> el primer argumento de la acción denota al 
analizador sintáctico. Así pues el código <tex2html_verb_mark>2242<tex2html_verb_mark>
es una llamada al método <tex2html_verb_mark>2243<tex2html_verb_mark> del analizador. Este método
funciona como la macro <tex2html_verb_mark>2244<tex2html_verb_mark> de <tex2html_verb_mark>2245<tex2html_verb_mark>, indicando 
que la presencia del retorno del carro (<tex2html_verb_mark>2246<tex2html_verb_mark>) la podemos considerar
un signo seguro de que nos hemos recuperado del error. A partir
de este momento, <tex2html_verb_mark>2247<tex2html_verb_mark> volverá a emitir mensajes de error.
Para saber más sobre la recuperación de 
errores en <tex2html_verb_mark>2248<tex2html_verb_mark> léase la sección
<A HREF=<tex2html_cr_mark>#section:errores#17270><tex2html_cr_mark></A>.

<P>
<PRE><tex2html_verbatim_mark>verbatim6097#</PRE>
La acción por defecto es retornar <tex2html_verb_mark>2249<tex2html_verb_mark>. 
Por tanto, en este caso el valor retornado es el asociado a <tex2html_verb_mark>2250<tex2html_verb_mark>.
<PRE><tex2html_verbatim_mark>verbatim6098#</PRE>
El método <tex2html_verb_mark>2251<tex2html_verb_mark> provee acceso a un hash que contiene los datos 
que están siendo analizados. En este caso creamos una entrada
<tex2html_verb_mark>2252<tex2html_verb_mark> que es una referencia a un hash en el que guardamos las
variables. Este hash es la tabla de símbolos de la calculadora.
<PRE><tex2html_verbatim_mark>verbatim6099#</PRE>
Hay numerosas ambiguedades en esta gramática. Por ejemplo,

<P>

<UL>
<LI>¿Como debo interpretar la expresión <tex2html_verb_mark>2253<tex2html_verb_mark>?
¿Como <tex2html_verb_mark>2254<tex2html_verb_mark>? ¿o bien <tex2html_verb_mark>2255<tex2html_verb_mark>?
La respuesta la da la asignación de asociatividad a los operadores
que hicimos en las líneas 9-13.
Al declarar como asociativo a izquierdas al terminal <tex2html_verb_mark>2256<tex2html_verb_mark> 
(línea 10) hemos 
resuelto este tipo de ambiguedad. Lo que estamos haciendo es
indicarle al analizador que a la hora de elegir entre 
los árboles abstractos 
<tex2html_verbatim_mark>#math7008#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36766#</SPAN>
<tex2html_verbatim_mark>mathend000# y <tex2html_verbatim_mark>#math7009#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36768#</SPAN>
<tex2html_verbatim_mark>mathend000# elija siempre
el árbol que se hunde a izquierdas.
</LI>
<LI>¿Como debo interpretar la expresión <tex2html_verb_mark>2257<tex2html_verb_mark>?
¿Como <tex2html_verb_mark>2258<tex2html_verb_mark>? ¿o bien <tex2html_verb_mark>2259<tex2html_verb_mark>?
Al declarar que <tex2html_verb_mark>2260<tex2html_verb_mark> tiene mayor prioridad que <tex2html_verb_mark>2261<tex2html_verb_mark> estamos
resolviendo esta otra fuente de ambiguedad. Esto es así pues
<tex2html_verb_mark>2262<tex2html_verb_mark> fué declarado en la línea 11 y <tex2html_verb_mark>2263<tex2html_verb_mark> en la 10.
</LI>
</UL>

<P>
<PRE><tex2html_verbatim_mark>verbatim6100#</PRE>

<P>
En la regla de la división comprobamos que el divisor es 
distinto de cero. Si es cero inicializamos el atributo 
<tex2html_verb_mark>2264<tex2html_verb_mark> en la zona de datos con el mensaje de
error apropiado. Este mensaje es aprovechado por la subrutina
de tratamiento de errores (véase la subrutina <tex2html_verb_mark>2265<tex2html_verb_mark>
en la zona de la cola). La subrutina <tex2html_verb_mark>2266<tex2html_verb_mark> es llamada
automáticamente por <tex2html_verb_mark>2267<tex2html_verb_mark> cada vez que ocurre un error
sintáctico. Esto es asi por que en la llamada 
al analizador se especifican quienes son las diferentes
rutinas de apoyo:

<P>
<PRE><tex2html_verbatim_mark>verbatim6101#</PRE>

<P>
Por defecto, <SPAN  CLASS="textbf">una regla de producción
tiene la prioridad del último terminal que aparece
en su parte derecha</SPAN>.
Una regla de producción puede ir seguida de una directiva
<tex2html_verb_mark>2269<tex2html_verb_mark> la cual le da una prioridad explícita.  
Esto puede ser de gran ayuda en ciertos casos de 
ambiguedad.

<P>
<PRE><tex2html_verbatim_mark>verbatim6102#</PRE>
¿Cual es la ambiguedad que surge con esta regla? 
Una de las ambiguedad de esta regla 
esta relacionada con el doble significado
del menos como operador unario y binario: hay frases
como <tex2html_verb_mark>2270<tex2html_verb_mark> que tiene dos posibles interpretaciones:
Podemos verla como <tex2html_verb_mark>2271<tex2html_verb_mark> o bien como <tex2html_verb_mark>2272<tex2html_verb_mark>.
Hay dos árboles posibles. El analizador, cuando este analizando
la entrada <tex2html_verb_mark>2273<tex2html_verb_mark> y vea el
segundo <tex2html_verb_mark>2274<tex2html_verb_mark> deberá escoger uno de los dos árboles. 
¿Cuál?. El conflicto puede verse como una ``lucha'' entre
la regla <tex2html_verb_mark>2275<tex2html_verb_mark> la cual interpreta la frase como
<tex2html_verb_mark>2276<tex2html_verb_mark> y la segunda aparición del terminal <tex2html_verb_mark>2277<tex2html_verb_mark> 
el cuál ``quiere entrar'' para que gane la regla <tex2html_verb_mark>2278<tex2html_verb_mark>
y dar lugar a la interpretación <tex2html_verb_mark>2279<tex2html_verb_mark>.
En este caso, las dos reglas 
<tex2html_verbatim_mark>#math7010#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36770#</SPAN>
<tex2html_verbatim_mark>mathend000# y <tex2html_verbatim_mark>#math7011#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36772#</SPAN>
<tex2html_verbatim_mark>mathend000# tienen, en principio
la prioridad del terminal <tex2html_verb_mark>2280<tex2html_verb_mark>, el cual fué declarado en la
línea 10.
La prioridad expresada explícitamente
para la regla por la declaración <tex2html_verb_mark>2282<tex2html_verb_mark> de la línea
39 hace que la regla tenga la prioridad
del terminal <tex2html_verb_mark>2283<tex2html_verb_mark> (línea 12) y por tanto mas prioridad
que el terminal <tex2html_verb_mark>2284<tex2html_verb_mark>. Esto hará que <tex2html_verb_mark>2285<tex2html_verb_mark> finalmente opte
por la regla <tex2html_verb_mark>2286<tex2html_verb_mark>.

<P>
La declaración de <tex2html_verb_mark>2287<tex2html_verb_mark> como asociativo a derechas y con un nivel
de prioridad alto resuelve las ambiguedades relacionadas 
con este operador:

<P>
<PRE><tex2html_verbatim_mark>verbatim6103#</PRE>

<P>
Después de la parte de la gramática, y separada de la anterior
por el símbolo <tex2html_verb_mark>2289<tex2html_verb_mark>, sigue la parte en la que se 
suelen poner las rutinas de apoyo. Hay al menos dos rutinas de apoyo que 
el analizador sintáctico requiere le sean pasados como argumentos: 
la de manejo de errores y la de análisis léxico. El método <tex2html_verb_mark>2290<tex2html_verb_mark>
ilustra como se hace la llamada al método de análisis sintáctico 
generado, utilizando la técnica de llamada con argumentos con nombre 
y pasándole las referencias a las dos subrutinas (en Perl,
es un convenio que si el nombre de una subrutina comienza
por un guión bajo es que el autor la considera privada):
<PRE><tex2html_verbatim_mark>verbatim6104#</PRE>

<P>
La subrutina de manejo de errores <tex2html_verb_mark>2291<tex2html_verb_mark> imprime 
el mensaje de error proveído por el usuario, el cual, si existe, fué guardado en
<tex2html_verb_mark>2292<tex2html_verb_mark>.
<PRE><tex2html_verbatim_mark>verbatim6105#</PRE>
A continuación sigue el método que implanta
el  análisis léxico <tex2html_verb_mark>2293<tex2html_verb_mark>.
En primer lugar se comprueba la existencia de
datos en <tex2html_verb_mark>2294<tex2html_verb_mark>. Si no es el caso, los datos
se tomarán de la entrada estándar:
<PRE><tex2html_verbatim_mark>verbatim6106#</PRE>
Cuando el analizador léxico alcanza el final de la entrada
debe devolver la pareja <tex2html_verb_mark>2295<tex2html_verb_mark>.

<P>
Eliminamos los blancos iniciales (lo que en inglés se conoce por
<A NAME="18315"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">trimming</SPAN>):
<PRE><tex2html_verbatim_mark>verbatim6107#</PRE>
A continuación vamos detectando los números, identificadores
y los símbolos individuales. El bucle <tex2html_verb_mark>2296<tex2html_verb_mark>
se ejecuta mientras la cadena
en <tex2html_verb_mark>2297<tex2html_verb_mark> no sea vacía, lo que ocurrirá cuando todos 
los terminales hayan sido consumidos.

<P>
<PRE><tex2html_verbatim_mark>verbatim6108#</PRE>

<P>
<P><DIV><#36774#><B>Ejercicio  <SPAN CLASS="arabic">35</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN></B><#36774#> &nbsp; 
<#36777#><I></I>
<OL>
<LI>¿Quién es la variable índice en la línea 65? 
</LI>
<LI>¿Sobre quién ocurre el binding en las líneas 66, 68 y 70? 
</LI>
<LI>¿Cual es la razón por la que <tex2html_verb_mark>2298<tex2html_verb_mark> se 
ve modificado si no aparece como variable para el binding en las líneas 66, 68 y 70?
</LI>
</OL><I></I><#36777#></DIV><P></P>


<P>
Construimos el módulo <tex2html_verb_mark>2299<tex2html_verb_mark> a partir del fichero <tex2html_verb_mark>2300<tex2html_verb_mark>
especificando la gramática, usando un fichero <tex2html_verb_mark>2301<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim6109#</PRE>
Esta compilación genera el fichero <tex2html_verb_mark>2302<tex2html_verb_mark> conteniendo el
analizador:
<PRE><tex2html_verbatim_mark>verbatim6110#</PRE>

<P>
El script <tex2html_verb_mark>2303<tex2html_verb_mark> es un <SPAN  CLASS="textbf">frontend</SPAN> al módulo <tex2html_verb_mark>2304<tex2html_verb_mark>.
Admite diversas formas de uso:

<P>

<UL>
<LI><#18219#><TT>yapp [options] <SPAN  CLASS="textit">grammar</SPAN>[.yp]</TT><#18219#>

<P>
El sufijo <#17310#><TT>.yp</TT><#17310#> es opcional.
</LI>
<LI><#18220#><TT>yapp <SPAN  CLASS="textit">-V</SPAN></TT><#18220#>

<P>
Nos muestra la versión:
<PRE><tex2html_verbatim_mark>verbatim6111#</PRE>

<P>
</LI>
<LI><#18221#><TT>yapp <SPAN  CLASS="textit">-h</SPAN></TT><#18221#>

<P>
Nos muestra la ayuda:

<P>
<PRE><tex2html_verbatim_mark>verbatim6112#</PRE>

<P>
</LI>
</UL>

<P>
La opción <SPAN  CLASS="textit">-m module</SPAN> 
da el nombre  al paquete o espacio de nombres o clase encapsulando el
analizador. Por defecto toma el nombre de la gramática.  En el ejemplo
podría haberse omitido.

<P>
La opción <SPAN  CLASS="textit">-o outfile</SPAN> 
da el nombre del fichero de salida. Por defecto toma el nombre de la gramática,
seguido del sufijo <tex2html_verb_mark>2305<tex2html_verb_mark>. sin embargo, si hemos especificado la opción
<SPAN  CLASS="textit">-m A::Module::Name</SPAN> el valor por defecto será  <SPAN  CLASS="textbf">Name.pm</SPAN>.

<P>
Veamos los contenidos del ejecutable <tex2html_verb_mark>2306<tex2html_verb_mark> el cuál
utiliza el módulo generado por <tex2html_verb_mark>2307<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim6113#</PRE>
Al ejecutar obtenemos:
<PRE><tex2html_verbatim_mark>verbatim6114#</PRE>
Pulsamos al final <tex2html_verb_mark>2308<tex2html_verb_mark> para generar el final de fichero.
El analizador devuelve la lista de valores computados la cual es 
finalmente impresa.

<P>
¿En que orden ejecuta <tex2html_verb_mark>2309<tex2html_verb_mark> las acciones? 
La respuesta es que el analizador generado por 
<tex2html_verb_mark>2310<tex2html_verb_mark> construye una derivación a derechas 
inversa y ejecuta las acciones asociadas a las reglas de producción
que se han aplicado. Así, para la frase <tex2html_verb_mark>2311<tex2html_verb_mark> la antiderivación es:

<P>
<DIV ALIGN="CENTER">
</DIV><tex2html_verbatim_mark>#math7012#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36779#</SPAN>
<tex2html_verbatim_mark>mathend000#<DIV ALIGN="CENTER">
</DIV>

<P>
por tanto las acciones ejecutadas son las asociadas con las correspondientes reglas 
de producción:

<OL>
<LI>La acción de la línea 25:
<PRE><tex2html_verbatim_mark>verbatim6115#</PRE>
Esta instancia de <tex2html_verb_mark>2312<tex2html_verb_mark> tiene ahora como atributo <tex2html_verb_mark>2313<tex2html_verb_mark>.
</LI>
<LI>De nuevo la acción de la línea 25:
<PRE><tex2html_verbatim_mark>verbatim6116#</PRE>
Esta nueva instancia de <tex2html_verb_mark>2314<tex2html_verb_mark> tiene como atributo <tex2html_verb_mark>2315<tex2html_verb_mark>.
</LI>
<LI>La acción asociada con <tex2html_verbatim_mark>#math7013#<SPAN CLASS="MATH"><tex2html_image_mark>#tex2html_wrap_inline36781#</SPAN>
<tex2html_verbatim_mark>mathend000#, en la línea 28:
<PRE><tex2html_verbatim_mark>verbatim6117#</PRE>
La nueva instancia (nodo) <tex2html_verb_mark>2316<tex2html_verb_mark> tiene como atributo <tex2html_verb_mark>2317<tex2html_verb_mark>. 
</LI>
</OL>
Obsérvese que la antiderivación a derechas da lugar a un
recorrido ascendente y a izquierdas del árbol:

<P>
<PRE><tex2html_verbatim_mark>verbatim6118#</PRE>

<P>
Los números entre paréntesis indican el orden de visita de las producciones.

<P>
