
<H1><A NAME="SECTION05490000000000000000">
Analisis Sintáctico con Expresiones Regulares Perl</A>
</H1>

<P>

<H2><A NAME="SECTION05491000000000000000">
Introducción al Anaĺisis Sintáctico con Expresiones Regulares</A>
</H2>

<P>
Como se ha comentado en la sección
<A HREF=<tex2html_cr_mark>#subsection:regexp510lenrec#7448><tex2html_cr_mark></A>
Perl 5.10 permite el reconocimiento de expresiones
definidas mediante gramáticas recursivas, siempre que 
estas puedan ser analizadas por un analizador recursivo descendente.
Sin embargo, las expresiones regulares Perl 5.10 
hace difícil construir una representación 
del árbol de análisis sintáctico abstracto. Además, la necesidad
de explicitar en la regexp los blancos existentes entre los símbolos
hace que la descripción sea menos robusta y menos legible.

<P>

<H4><A NAME="SECTION05491010000000000000">
Ejemplo: Traducción de expresiones aritméticas en infijo a postfijo</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
El siguiente ejemplo muestra una expresión regular
que traduce expresiones de diferencias en infijo
a postfijo.

<P>
Se usa una variable <tex2html_verb_mark>1242<tex2html_verb_mark> 
para calcular la traducción de
la subexpresión vista hasta el momento.

<P>
La gramática original que consideramos
es recursiva a izquierdas:
<PRE><tex2html_verbatim_mark>verbatim1563#</PRE>
aplicando las técnicas explicadas en
<A HREF=<tex2html_cr_mark>#subsection:eliminaleftrec#7452><tex2html_cr_mark></A> y en 
el nodo de perlmonks
<A NAME="tex2html284"
  HREF="http://www.perlmonks.org/?node_id=Operator Associativity and Eliminating Left-Recursion in Parse::RecDescent">553889</A>
transformamos la gramática en:
<PRE><tex2html_verbatim_mark>verbatim1564#</PRE>

<P>
Sigue el código:
<tex2html_verbatim_mark>rawhtml1565#
La variable <tex2html_verb_mark>1243<tex2html_verb_mark> contiene el valor que casó con el último paréntesis.
Al ejecutar el código anterior obtenemos:

<P>
Véase la ejecución:
<PRE><tex2html_verbatim_mark>verbatim1566#</PRE>

<P>
Como se ve, el recorrido primero profundo se 
traduce en la reconstrucción de una derivación a derechas.

<P>

<H4><A NAME="SECTION05491020000000000000">
Accediendo a los atributos de paréntesis anteriores mediante acciones intermedias</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
Es difícil extender el ejemplo anterior a lenguajes mas complejos debido a la 
limitación de que sólo se dispone de acceso al último paréntesis vía <tex2html_verb_mark>1244<tex2html_verb_mark>.
En muchos casos es necesario poder acceder a paréntesis/atributos anteriores.

<P>
El siguiente código considera el caso de expresiones con sumas, restas, multiplicaciones
y divisiones. Utiliza la variable <tex2html_verb_mark>1245<tex2html_verb_mark> y una acción intermedia (líneas 51-53) 
para almacenar el segundo paréntesis necesitado:
<tex2html_verbatim_mark>rawhtml1567#

<P>
Sigue una ejecución:
<PRE><tex2html_verbatim_mark>verbatim1568#</PRE>

<P>

<H4><A NAME="SECTION05491030000000000000">
Accediendo a los atributos de paréntesis anteriores mediante <TT>@-</TT></A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
Sigue una solución alternativa que obvia la necesidad de introducir
incómodas acciones intermedias. Utilizamos 
las variables <tex2html_verb_mark>1246<tex2html_verb_mark> y <tex2html_verb_mark>1247<tex2html_verb_mark>:

<P>
<I></I>
<BLOCKQUOTE><I>Since Perl 5.6.1 the special variables <tex2html_verb_mark>1248<tex2html_verb_mark> and <tex2html_verb_mark>1249<tex2html_verb_mark> can functionally replace
<tex2html_verb_mark>1250<tex2html_verb_mark>, <tex2html_verb_mark>1251<tex2html_verb_mark> and <tex2html_verb_mark>1252<tex2html_verb_mark>. These arrays contain pointers to the beginning and end of
each match (see <A NAME="tex2html285"
  HREF="http://search.cpan.org/perldoc/?perlvar"><TT>perlvar</TT></A>
for the full story), so they give you essentially
the same information, but without the risk of excessive string copying.
</I></BLOCKQUOTE><I></I>

<P>
Véanse los párrafos en las páginas
<A HREF=<tex2html_cr_mark>#parrafo:fincas#7468><tex2html_cross_ref_visible_mark></A>, <A HREF=<tex2html_cr_mark>#parrafo:iniciocas#7469><tex2html_cross_ref_visible_mark></A>) y
<A HREF=<tex2html_cr_mark>#parrafo:lastpar#7470><tex2html_cross_ref_visible_mark></A> para mas información sobre <tex2html_verb_mark>1253<tex2html_verb_mark> y <tex2html_verb_mark>1254<tex2html_verb_mark>.

<P>
Nótese la función <tex2html_verb_mark>1255<tex2html_verb_mark> en las líneas
21-28. <tex2html_verb_mark>1256<tex2html_verb_mark> nos retorna lo que casó con el último paréntesis,
<tex2html_verb_mark>1257<tex2html_verb_mark> lo que casó con el penúltimo, etc.

<P>
<tex2html_verbatim_mark>rawhtml1569#

<P>
Ahora accedemos a los atributos asociados con los dos paréntesis,
en la regla de <tex2html_verb_mark>1258<tex2html_verb_mark> usando la función <tex2html_verb_mark>1259<tex2html_verb_mark>:

<P>
<PRE><tex2html_verbatim_mark>verbatim1570#</PRE>

<P>
Sigue una ejecución del programa:

<P>
<PRE><tex2html_verbatim_mark>verbatim1571#</PRE>

<P>

<H4><A NAME="SECTION05491040000000000000">
Accediendo a los atributos de paréntesis anteriores mediante paréntesis 
con nombre</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
Una nueva solución: dar nombre a los paréntesis y acceder a los mismos:
<PRE><tex2html_verbatim_mark>verbatim1572#</PRE>

<P>
Sigue el código completo:

<P>
<tex2html_verbatim_mark>rawhtml1573#

<P>
Ejecución:
<PRE><tex2html_verbatim_mark>verbatim1574#</PRE>

<P>

<H4><A NAME="SECTION05491050000000000000">
Véase También</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<UL>
<LI>El nodo <#7482#><I>Backreference variables in code embedded inside Perl 5.10 regexps</I><#7482#> en 
<A NAME="tex2html286"
  HREF="http://www.perlmonks.org/?node_id=794424">PerlMonks</A>
<P>
</LI>
<LI>El nodo <#7484#><I>Strange behavior of @- and @+ in perl5.10 regexps</I><#7484#> en 
<A NAME="tex2html287"
  HREF="http://www.perlmonks.org/?node_id=794736">PerlMonks</A>
<P>
</LI>
</UL>

<P>

<H2><A NAME="SECTION05492000000000000000">
Construyendo el AST con Expresiones Regulares 5.10</A>
</H2>

<P>
Construiremos en esta sección un traductor de infijo a postfijo
utilizando una aproximación general: construiremos una representación
del Abstract Syntax Tree o AST (véase la sección 
<A HREF=<tex2html_cr_mark>#section:aat#7488><tex2html_cr_mark></A>
Árbol de Análisis Abstracto para una definición detallada de que es un árbol sintáctico).

<P>
Como la aplicación es un poco mas compleja la hemos dividido en varios ficheros.
Esta es la estructura:

<P>
<PRE><tex2html_verbatim_mark>verbatim1575#</PRE>

<P>
La salida del programa puede ser dividida en tres partes.
La primera muestra una antiderivación a derechas inversa:
<PRE><tex2html_verbatim_mark>verbatim1576#</PRE>
Que leída de abajo a arriba nos da una derivación a derechas de la cadena <tex2html_verb_mark>1260<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim1577#</PRE>
La segunda parte nos muestra la representación del AST para la entrada dada (<tex2html_verb_mark>1261<tex2html_verb_mark>):
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=142><PRE><tex2html_verbatim_mark>verbatim1578#</PRE></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=113><tex2html_verbatim_mark>rawhtml1579#</TD>
</TR>
</TABLE>

<P>
La última parte de la salida nos muestra la traducción a postfijo
de la expresión en infijo
suministrada en la entrada (<tex2html_verb_mark>1262<tex2html_verb_mark>):
<PRE><tex2html_verbatim_mark>verbatim1580#</PRE>

<P>

<H4><A NAME="SECTION05492010000000000000">
Programa Principal: usando la pila de atributos</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
La gramática original que consideramos
es recursiva a izquierdas:
<PRE><tex2html_verbatim_mark>verbatim1581#</PRE>
aplicando las técnicas explicadas en
<A HREF=<tex2html_cr_mark>#subsection:eliminarecesquem#7506><tex2html_cr_mark></A>
es posible transformar la gramática 
en una no recursiva por la izquierda:
<PRE><tex2html_verbatim_mark>verbatim1582#</PRE>

<P>
Ahora bien, no basta con transformar la gramática en una equivalente.
Lo que tenemos como punto de partida no es una gramática sino un <A NAME="8501"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textbf">esquema de traducción</SPAN>
(véase la sección 
<A HREF=<tex2html_cr_mark>#section:esquemas#7510><tex2html_cr_mark></A>)
que construye el AST asociado con la expresión.
Nuestro esquema de traducción conceptual es algo así:
<PRE><tex2html_verbatim_mark>verbatim1583#</PRE>

<P>
Lo que queremos conseguir un conjunto de acciones semánticas
asociadas para gramática no recursiva que sea equivalente 
a este.

<P>
Este es el programa resultante una vez aplicadas las transformaciones.
La implementación de la asociación entre símbolos y atributos la realizamos
manualmente mediante una pila de atributos:
<PRE><tex2html_verbatim_mark>verbatim1584#</PRE>

<P>

<H4><A NAME="SECTION05492020000000000000">
Las Clases representando a los AST</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
Cada nodo del AST es un objeto. La clase del nodo nos dice que tipo de nodo es.
Así los nodos de la clase <tex2html_verb_mark>1263<tex2html_verb_mark> agrupan a los nódos de multiplicación y división.
Los nodos de la clase <tex2html_verb_mark>1264<tex2html_verb_mark> agrupan a los nódos de suma y resta.
El procedimiento general es asociar un método <tex2html_verb_mark>1265<tex2html_verb_mark> con cada clase de nodo.
De esta forma se logra el polimorfismo necesario: cada clase de nodo sabe como traducirse
y el método <tex2html_verb_mark>1266<tex2html_verb_mark> de cada clase puede escribirse como

<UL>
<LI>Obtener los resultados de llamar a <tex2html_verb_mark>1267<tex2html_verb_mark> para cada uno
de los nodos hijos <tex2html_verb_mark>1268<tex2html_verb_mark>. Por ejemplo, si el nodo fuera un nodo <tex2html_verb_mark>1269<tex2html_verb_mark>
de un hipotético lenguaje de programación, se llamaría a los métodos <tex2html_verb_mark>1270<tex2html_verb_mark> sobre sus tres hijos
<tex2html_verb_mark>1271<tex2html_verb_mark>, <tex2html_verb_mark>1272<tex2html_verb_mark> y <tex2html_verb_mark>1273<tex2html_verb_mark>.
</LI>
<LI>Combinar los resultados para producir la traducción adecuada del nodo actual.
</LI>
</UL>
Es esta combinación la que mas puede cambiar según el tipo de nodo. Así, en el caso de 
el nodo <tex2html_verb_mark>1274<tex2html_verb_mark> el seudocódigo para la traducción sería algo parecido a esto:

<P>
<PRE><tex2html_verbatim_mark>verbatim1585#</PRE>

<P>
Siguiendo estas observaciones el código de <tex2html_verb_mark>1275<tex2html_verb_mark> queda así:
<PRE><tex2html_verbatim_mark>verbatim1586#</PRE>

<P>
Véase también:

<UL>
<LI><A NAME="tex2html288"
  HREF="http://search.cpan.org/perldoc?Class::Accessor"><TT>Class::Accessor</TT></A>
</LI>
</UL>

<P>

<H4><A NAME="SECTION05492030000000000000">
Accediendo a los paréntesis lejanos: El módulo <TT>Regexp::Paren</TT></A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
En esta solución utilizamos 
las variables <tex2html_verb_mark>1276<tex2html_verb_mark> y <tex2html_verb_mark>1277<tex2html_verb_mark> para construir una función que nos 
permite acceder a lo que casó con 
los últimos paréntesis con memoria:

<P>
<I></I>
<BLOCKQUOTE><I>Since Perl 5.6.1 the special variables <tex2html_verb_mark>1278<tex2html_verb_mark> and <tex2html_verb_mark>1279<tex2html_verb_mark> can functionally replace
<tex2html_verb_mark>1280<tex2html_verb_mark>, <tex2html_verb_mark>1281<tex2html_verb_mark> and <tex2html_verb_mark>1282<tex2html_verb_mark>. These arrays contain pointers to the beginning and end of
each match (see <A NAME="tex2html289"
  HREF="http://search.cpan.org/perldoc/?perlvar"><TT>perlvar</TT></A>
for the full story), so they give you essentially
the same information, but without the risk of excessive string copying.
</I></BLOCKQUOTE><I></I>

<P>
Véanse los párrafos en las páginas
<A HREF=<tex2html_cr_mark>#parrafo:fincas#7531><tex2html_cross_ref_visible_mark></A>, <A HREF=<tex2html_cr_mark>#parrafo:iniciocas#7532><tex2html_cross_ref_visible_mark></A>) y
<A HREF=<tex2html_cr_mark>#parrafo:lastpar#7533><tex2html_cross_ref_visible_mark></A> para mas información sobre <tex2html_verb_mark>1283<tex2html_verb_mark> y <tex2html_verb_mark>1284<tex2html_verb_mark>.

<P>
<tex2html_verb_mark>1285<tex2html_verb_mark> nos retorna lo que casó con el último paréntesis,
<tex2html_verb_mark>1286<tex2html_verb_mark> lo que casó con el penúltimo, etc.

<P>
<PRE><tex2html_verbatim_mark>verbatim1587#</PRE>

<P>
Al ejecutar <tex2html_verb_mark>1287<tex2html_verb_mark> podemos ver la documentación
incluida (véase la documentación en <A NAME="tex2html290"
  HREF="http://search.cpan.org/perldoc/?perlpod"><TT>perlpod</TT></A>
y <A NAME="tex2html291"
  HREF="http://search.cpan.org/perldoc/?perlpodspec"><TT>perlpodspec</TT></A>
así como la sección <A NAME="tex2html292"
  HREF="http://www.google.es/search?q=site:nereida.deioc.ull.es+La Documentación en Perl;SPMamp;ie=UTF-8;SPMamp;hl=es">La Documentación en Perl</A>
para mas detalles):

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=624><PRE><tex2html_verbatim_mark>verbatim1588#</PRE></TD>
</TR>
</TABLE>

<P>
